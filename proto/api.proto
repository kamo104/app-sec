syntax = "proto3";

package api.v1;

// ------ RESPONSES ------

// API Response Codes
enum ResponseCode {
  RESPONSE_CODE_UNSPECIFIED = 0;

  // Success codes
  SUCCESS = 1;
  SUCCESS_REGISTERED = 2;

  // Error codes
  ERROR_INVALID_INPUT = 100;
  ERROR_USERNAME_TAKEN = 101;
  ERROR_INVALID_CREDENTIALS = 102;
  ERROR_EMAIL_NOT_VERIFIED = 103;
  ERROR_INVALID_TOKEN = 104;
  ERROR_DATABASE = 105;
  ERROR_INTERNAL = 106;
  ERROR_VALIDATION = 107;
}

// Login response data
message LoginResponseData {
  string username = 1;
  string email = 2;
  int64 session_expires_at = 3; // Unix timestamp in seconds
  int64 session_created_at = 4; // Unix timestamp in seconds
}

// Counter data
message CounterData {
  int64 value = 1;
}

message ApiData {
  oneof data {
    LoginResponseData login_response = 1;
    ValidationErrorData validation_error = 2; 
    CounterData counter_data = 3;
  }
}

// Generic API response wrapper
message ApiResponse {
  ResponseCode code = 2;
  optional ApiData data = 3;
}
// ------ RESPONSES ------

// ------ REQUESTS ------

// Registration request
message RegistrationRequest {
  string username = 1;
  string email = 2;
  string password = 3;
}

// Login request
message LoginRequest {
  string username = 1;
  string password = 2;
}

// Email verification request
message EmailVerificationRequest {
  string token = 1;
}

// Set counter request
message SetCounterRequest {
  int64 value = 1;
}

// Password reset request (initial step)
message PasswordResetRequest {
  string email = 1;
}

// Password reset completion request
message PasswordResetCompleteRequest {
  string token = 1;
  string new_password = 2;
}

// ------ REQUESTS ------

// ------ VALIDATION ------
enum FieldType {
  FIELD_TYPE_UNSPECIFIED = 0;
  USERNAME = 1;
  EMAIL = 2;
  PASSWORD = 3;
}

enum ValidationErrorCode {
  VALIDATION_ERROR_CODE_UNSPECIFIED = 0;

  REQUIRED = 1;
  TOO_SHORT = 2;
  TOO_LONG = 3;
  INVALID_CHARACTERS = 4;
  INVALID_FORMAT = 5;
  TOO_FEW_UPPERCASE_LETTERS = 6;
  TOO_FEW_LOWERCASE_LETTERS = 7;
  TOO_FEW_DIGITS = 8;
  TOO_FEW_SPECIAL_CHARACTERS = 9;
}

// Error details for validation - single field
message ValidationFieldError {
  FieldType field = 1;
  repeated ValidationErrorCode errors = 2;
}

// Error details for validation - multiple fields
message ValidationErrorData {
  repeated ValidationFieldError field_errors = 1;
}

// Password strength levels
enum PasswordStrength {
  PASSWORD_STRENGTH_UNSPECIFIED = 0;
  PASSWORD_STRENGTH_WEAK = 1;
  PASSWORD_STRENGTH_MEDIUM = 2;
  PASSWORD_STRENGTH_STRONG = 3;
  PASSWORD_STRENGTH_CIA = 4;
}

message ValidationDetailedPasswordData {
  ValidationFieldError data = 1;
  PasswordStrength strength = 2;
  uint32 score = 3;
}
// ------ VALIDATION ------
