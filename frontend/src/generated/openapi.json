{"openapi":"3.1.0","info":{"title":"AppSec Demo API","description":"Web app demonstration focused on using good web security practices","version":"1.0.0"},"paths":{"/api/auth/check":{"get":{"tags":["auth"],"operationId":"auth_check","responses":{"200":{"description":"Session is valid","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponseData"}}}},"401":{"description":"Not authenticated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/auth/refresh":{"post":{"tags":["auth"],"operationId":"refresh_session","responses":{"200":{"description":"Session refreshed successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponseData"}}}},"401":{"description":"Not authenticated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/complete-password-reset":{"post":{"tags":["auth"],"operationId":"complete_password_reset","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordResetCompleteRequest"}}},"required":true},"responses":{"200":{"description":"Password reset completed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"400":{"description":"Invalid token or validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/counter/get":{"get":{"tags":["counter"],"operationId":"get_counter","responses":{"200":{"description":"Counter value retrieved","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CounterData"}}}},"401":{"description":"Not authenticated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/counter/set":{"post":{"tags":["counter"],"operationId":"set_counter","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SetCounterRequest"}}},"required":true},"responses":{"200":{"description":"Counter value updated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CounterData"}}}},"401":{"description":"Not authenticated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/health":{"get":{"tags":["health"],"operationId":"health_check","responses":{"200":{"description":"Health check successful","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}}}}},"/api/login":{"post":{"tags":["auth"],"operationId":"login_user","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Login successful","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponseData"}}}},"400":{"description":"Validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"401":{"description":"Invalid credentials or email not verified","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/logout":{"post":{"tags":["auth"],"operationId":"logout_user","responses":{"200":{"description":"Logged out successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}}}}},"/api/register":{"post":{"tags":["auth"],"operationId":"register_user","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegistrationRequest"}}},"required":true},"responses":{"200":{"description":"User registered successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"400":{"description":"Validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"409":{"description":"Username or email already taken","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/request-password-reset":{"post":{"tags":["auth"],"operationId":"request_password_reset","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordResetRequest"}}},"required":true},"responses":{"200":{"description":"Password reset requested (always returns success for security)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}}}}},"/api/verify-email":{"post":{"tags":["auth"],"operationId":"verify_email","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmailVerificationRequest"}}},"required":true},"responses":{"200":{"description":"Email verified successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"400":{"description":"Invalid or expired token","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}}},"components":{"schemas":{"CounterData":{"type":"object","description":"Counter data containing the current counter value.","required":["value"],"properties":{"value":{"type":"integer","format":"int64"}}},"EmailVerificationRequest":{"type":"object","description":"Email verification request payload.","required":["token"],"properties":{"token":{"type":"string"}}},"ErrorCode":{"type":"string","description":"Error codes for specific error types.","enum":["ERROR_CODE_UNSPECIFIED","INVALID_INPUT","USERNAME_TAKEN","INVALID_CREDENTIALS","EMAIL_NOT_VERIFIED","INVALID_TOKEN","DATABASE","INTERNAL","VALIDATION","EMAIL_TAKEN"]},"ErrorResponse":{"type":"object","description":"Error response returned for all error cases.","required":["error"],"properties":{"error":{"$ref":"#/components/schemas/ErrorCode"},"validation":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ValidationErrorData"}]}}},"FieldType":{"type":"string","description":"Field types for validation errors.","enum":["FIELD_TYPE_UNSPECIFIED","USERNAME","EMAIL","PASSWORD"]},"LoginRequest":{"type":"object","description":"Login request payload.","required":["username","password"],"properties":{"password":{"type":"string"},"username":{"type":"string"}}},"LoginResponseData":{"type":"object","description":"Login response data containing user info and session details.","required":["username","email","sessionExpiresAt","sessionCreatedAt"],"properties":{"email":{"type":"string"},"sessionCreatedAt":{"type":"integer","format":"int64","description":"Unix timestamp in seconds when the session was created."},"sessionExpiresAt":{"type":"integer","format":"int64","description":"Unix timestamp in seconds when the session expires."},"username":{"type":"string"}}},"PasswordResetCompleteRequest":{"type":"object","description":"Password reset completion request payload.","required":["token","newPassword"],"properties":{"newPassword":{"type":"string"},"token":{"type":"string"}}},"PasswordResetRequest":{"type":"object","description":"Password reset request payload (initial step).","required":["email"],"properties":{"email":{"type":"string"}}},"RegistrationRequest":{"type":"object","description":"Registration request payload.","required":["username","email","password"],"properties":{"email":{"type":"string"},"password":{"type":"string"},"username":{"type":"string"}}},"SetCounterRequest":{"type":"object","description":"Set counter request payload.","required":["value"],"properties":{"value":{"type":"integer","format":"int64"}}},"SuccessCode":{"type":"string","description":"Success codes for specific success outcomes.","enum":["SUCCESS_CODE_UNSPECIFIED","SUCCESS_OK","SUCCESS_REGISTERED","SUCCESS_LOGGED_IN","SUCCESS_LOGGED_OUT","SUCCESS_EMAIL_VERIFIED","SUCCESS_SESSION_REFRESHED","SUCCESS_PASSWORD_RESET_REQUESTED","SUCCESS_PASSWORD_RESET_COMPLETED","SUCCESS_COUNTER_UPDATED"]},"SuccessResponse":{"type":"object","description":"Simple success response with a code indicating what succeeded.","required":["success"],"properties":{"success":{"$ref":"#/components/schemas/SuccessCode"}}},"ValidationErrorCode":{"type":"string","description":"Validation error codes.","enum":["VALIDATION_ERROR_CODE_UNSPECIFIED","REQUIRED","TOO_SHORT","TOO_LONG","INVALID_CHARACTERS","INVALID_FORMAT","TOO_FEW_UPPERCASE_LETTERS","TOO_FEW_LOWERCASE_LETTERS","TOO_FEW_DIGITS","TOO_FEW_SPECIAL_CHARACTERS"]},"ValidationErrorData":{"type":"object","description":"Validation error data containing multiple field errors.","required":["fieldErrors"],"properties":{"fieldErrors":{"type":"array","items":{"$ref":"#/components/schemas/ValidationFieldError"}}}},"ValidationFieldError":{"type":"object","description":"Validation error for a single field.","required":["field","errors"],"properties":{"errors":{"type":"array","items":{"$ref":"#/components/schemas/ValidationErrorCode"}},"field":{"$ref":"#/components/schemas/FieldType"}}}}}}