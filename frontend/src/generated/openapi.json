{"openapi":"3.1.0","info":{"title":"AppSec Demo API","description":"Web app demonstration focused on using good web security practices","version":"1.0.0"},"paths":{"/api/auth/check":{"get":{"tags":["auth"],"operationId":"auth_check","responses":{"200":{"description":"Session is valid","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthSessionResponse"}}}},"401":{"description":"Not authenticated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthErrorResponse"}}}}}}},"/api/auth/refresh":{"post":{"tags":["auth"],"operationId":"refresh_session","responses":{"200":{"description":"Session refreshed successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthSessionResponse"}}}},"401":{"description":"Not authenticated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthErrorResponse"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthErrorResponse"}}}}}}},"/api/complete-password-reset":{"post":{"tags":["auth"],"operationId":"complete_password_reset","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordResetCompleteRequest"}}},"required":true},"responses":{"200":{"description":"Password reset completed"},"400":{"description":"Invalid token or validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CompletePasswordResetErrorResponse"}}}},"500":{"description":"Internal server error"}}}},"/api/counter/get":{"get":{"tags":["counter"],"operationId":"get_counter","responses":{"200":{"description":"Counter value retrieved","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CounterData"}}}},"401":{"description":"Not authenticated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthErrorResponse"}}}},"500":{"description":"Internal server error"}}}},"/api/counter/set":{"post":{"tags":["counter"],"operationId":"set_counter","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SetCounterRequest"}}},"required":true},"responses":{"200":{"description":"Counter value updated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CounterData"}}}},"401":{"description":"Not authenticated","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthErrorResponse"}}}},"500":{"description":"Internal server error"}}}},"/api/health":{"get":{"tags":["health"],"operationId":"health_check","responses":{"200":{"description":"Health check successful"}}}},"/api/login":{"post":{"tags":["auth"],"operationId":"login_user","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Login successful","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"400":{"description":"Validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginErrorResponse"}}}},"401":{"description":"Invalid credentials or email not verified","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginErrorResponse"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginErrorResponse"}}}}}}},"/api/logout":{"post":{"tags":["auth"],"operationId":"logout_user","responses":{"200":{"description":"Logged out successfully"}}}},"/api/register":{"post":{"tags":["auth"],"operationId":"register_user","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegistrationRequest"}}},"required":true},"responses":{"200":{"description":"User registered successfully"},"400":{"description":"Validation error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterErrorResponse"}}}},"409":{"description":"Username or email already taken","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterErrorResponse"}}}},"500":{"description":"Internal server error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterErrorResponse"}}}}}}},"/api/request-password-reset":{"post":{"tags":["auth"],"operationId":"request_password_reset","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordResetRequest"}}},"required":true},"responses":{"200":{"description":"Password reset requested (always returns success for security)"},"500":{"description":"Internal server error"}}}},"/api/verify-email":{"post":{"tags":["auth"],"operationId":"verify_email","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmailVerificationRequest"}}},"required":true},"responses":{"200":{"description":"Email verified successfully"},"400":{"description":"Invalid or expired token"},"500":{"description":"Internal server error"}}}}},"components":{"schemas":{"AuthError":{"type":"string","description":"Error codes for auth check and refresh endpoints.","enum":["INVALID_CREDENTIALS","INTERNAL"]},"AuthErrorResponse":{"type":"object","description":"Auth error response (used for auth check and refresh).","required":["error"],"properties":{"error":{"$ref":"#/components/schemas/AuthError"}}},"AuthSessionResponse":{"type":"object","description":"Auth session response - used for both auth check and refresh endpoints.","required":["username","email","sessionExpiresAt","sessionCreatedAt"],"properties":{"email":{"type":"string"},"sessionCreatedAt":{"type":"integer","format":"int64"},"sessionExpiresAt":{"type":"integer","format":"int64"},"username":{"type":"string"}}},"CompletePasswordResetError":{"type":"string","description":"Error codes specific to password reset completion endpoint.","enum":["INVALID_TOKEN","VALIDATION","INTERNAL"]},"CompletePasswordResetErrorResponse":{"type":"object","description":"Password reset completion error response.","required":["error"],"properties":{"error":{"$ref":"#/components/schemas/CompletePasswordResetError"},"validation":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ValidationErrorData"}]}}},"CounterData":{"type":"object","description":"Counter data containing the current counter value.","required":["value"],"properties":{"value":{"type":"integer","format":"int64"}}},"EmailVerificationRequest":{"type":"object","description":"Email verification request payload.","required":["token"],"properties":{"token":{"type":"string"}}},"FieldType":{"type":"string","description":"Field types for validation errors.","enum":["UNSPECIFIED","USERNAME","EMAIL","PASSWORD"]},"LoginError":{"type":"string","description":"Error codes specific to login endpoint.","enum":["INVALID_CREDENTIALS","EMAIL_NOT_VERIFIED","VALIDATION","INTERNAL"]},"LoginErrorResponse":{"type":"object","description":"Login error response.","required":["error"],"properties":{"error":{"$ref":"#/components/schemas/LoginError"},"validation":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ValidationErrorData"}]}}},"LoginRequest":{"type":"object","description":"Login request payload.","required":["username","password"],"properties":{"password":{"type":"string"},"username":{"type":"string"}}},"LoginResponse":{"type":"object","description":"Login success response.","required":["username","email","sessionExpiresAt","sessionCreatedAt"],"properties":{"email":{"type":"string"},"sessionCreatedAt":{"type":"integer","format":"int64","description":"Unix timestamp in seconds when the session was created."},"sessionExpiresAt":{"type":"integer","format":"int64","description":"Unix timestamp in seconds when the session expires."},"username":{"type":"string"}}},"PasswordResetCompleteRequest":{"type":"object","description":"Password reset completion request payload.","required":["token","newPassword"],"properties":{"newPassword":{"type":"string"},"token":{"type":"string"}}},"PasswordResetRequest":{"type":"object","description":"Password reset request payload (initial step).","required":["email"],"properties":{"email":{"type":"string"}}},"RegisterError":{"type":"string","description":"Error codes specific to registration endpoint.","enum":["USERNAME_TAKEN","EMAIL_TAKEN","VALIDATION","INTERNAL"]},"RegisterErrorResponse":{"type":"object","description":"Registration error response.","required":["error"],"properties":{"error":{"$ref":"#/components/schemas/RegisterError"},"validation":{"oneOf":[{"type":"null"},{"$ref":"#/components/schemas/ValidationErrorData"}]}}},"RegistrationRequest":{"type":"object","description":"Registration request payload.","required":["username","email","password"],"properties":{"email":{"type":"string"},"password":{"type":"string"},"username":{"type":"string"}}},"SetCounterRequest":{"type":"object","description":"Set counter request payload.","required":["value"],"properties":{"value":{"type":"integer","format":"int64"}}},"ValidationErrorCode":{"type":"string","description":"Validation error codes.","enum":["UNSPECIFIED","REQUIRED","TOO_SHORT","TOO_LONG","INVALID_CHARACTERS","INVALID_FORMAT","TOO_FEW_UPPERCASE_LETTERS","TOO_FEW_LOWERCASE_LETTERS","TOO_FEW_DIGITS","TOO_FEW_SPECIAL_CHARACTERS"]},"ValidationErrorData":{"type":"object","description":"Validation error data containing multiple field errors.","required":["fieldErrors"],"properties":{"fieldErrors":{"type":"array","items":{"$ref":"#/components/schemas/ValidationFieldError"}}}},"ValidationFieldError":{"type":"object","description":"Validation error for a single field.","required":["field","errors"],"properties":{"errors":{"type":"array","items":{"$ref":"#/components/schemas/ValidationErrorCode"}},"field":{"$ref":"#/components/schemas/FieldType"}}}}}}