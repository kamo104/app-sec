% Security Mechanisms
\section{Security Mechanisms}

This section describes the security measures implemented in the registration module.

\subsection{Password Security}

\begin{itemize}[leftmargin=*,nosep]
  \item Argon2 algorithm (memory-hard, GPU-resistant).
  \item Random salt generated using \texttt{SaltString::generate(\&mut OsRng)}.
  \item Password hash stored in PHC string format (includes algorithm, parameters, salt).
  \item Passwords are never logged, stored in plaintext, or returned to clients.
\end{itemize}

\subsection{Token Security}

\begin{itemize}[leftmargin=*,nosep]
  \item Verification tokens are 32 bytes of cryptographically secure random data.
  \item Tokens are hex-encoded for transmission (64 characters).
  \item Only SHA256 hashes of tokens are stored in the database.
  \item Plaintext tokens are sent only via email and never logged.
  \item Tokens have configurable expiry (\texttt{EMAIL\_VERIFICATION\_TOKEN\_DURATION\_HOURS}).
  \item One token per user (primary key constraint).
\end{itemize}

\subsection{Error Handling}

\begin{itemize}[leftmargin=*,nosep]
  \item Typed error codes from \texttt{api-types} crate.
  \item Specific codes for \texttt{USERNAME\_TAKEN} and \texttt{EMAIL\_TAKEN} (HTTP 409).
  \item Validation errors include field-specific details for user feedback.
  \item Internal errors return generic \texttt{INTERNAL} code (HTTP 500).
  \item All error codes translated to user-friendly messages via \texttt{translator} crate.
\end{itemize}

\subsection{Automatic Cleanup}

\begin{itemize}[leftmargin=*,nosep]
  \item Hourly cleanup task runs asynchronously.
  \item Deletes expired verification tokens.
  \item Deletes unverified users whose tokens have expired (via CASCADE).
  \item On email sending failure, user record is rolled back immediately.
\end{itemize}

\subsection{Future Enhancements}

\begin{itemize}[leftmargin=*,nosep]
  \item Rate limiting on registration endpoint.
  \item CAPTCHA integration for bot mitigation.
  \item Email domain whitelist/blacklist.
  \item Invite token system for controlled registration.
\end{itemize}
